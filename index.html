<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <style>
        #paper { position: absolute; border: 1px solid black; top: 0; left: 0; }
    </style>
</head>
<body>
    Hello hi<br/>
    <canvas id="paper" width="500" height="500"></canvas>
<script src="/client.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script>
$(function() {
    var ch = new Channel(12);
    ch.addListener(function(data) { console.log("data: " + data); });
    
    var paper = document.getElementById("paper");
    var ctx = paper.getContext("2d");
    var isMouseDown = false, basePos = $(paper).offset(), throttle = 0;
    
    $(document)
        .mousedown(function(e) {
            isMouseDown = (e.target == paper);
            
            if(isMouseDown) {
                ctx.beginPath();
                ctx.moveTo(e.pageX - basePos.left, e.pageY - basePos.top);
            }
        })
        .mousemove(function(e) {
            if(!isMouseDown) { return; }
            
            if((throttle++ % 2) !== 0) { return; }
            throttle = 0;
            
            ctx.lineTo(e.pageX - basePos.left, e.pageY - basePos.top);
            ctx.stroke();
        })
        .mouseup(function(e) {
            if(isMouseDown) {
                ctx.lineTo(e.pageX - basePos.left, e.pageY - basePos.top);
                ctx.stroke();
            }
            
            isMouseDown = false;
        });
});
</script>
</body>
</html>